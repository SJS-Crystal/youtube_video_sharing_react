name: Deploy to Test Server

on:
  workflow_dispatch:
    inputs:
        DOCKER_IMAGE_TAG:
            description: "Docker image tag"
            required: true

        serverSelection:
            description: "Enter server number (e.g., 1 for SERVER 1, 2 for SERVER 2)"
            required: true

        environmentName:
            description: "Select the environment (ENVs and secrets from this environment will be apply during deployment)"
            required: true
            type: choice
            options:
                - development
                - test
                - staging
                - production

jobs:
    deployment:
        runs-on: ubuntu-latest
        steps:
        - name: Set approvalEnvironmentName
          run: |
            echo "approvalEnvironmentName=approval_${{ github.event.inputs.environmentName }}_environment" >> $GITHUB_ENV
 
        - uses: ./.github/workflows/_deploy-template.yml

          with:
            DOCKER_IMAGE_TAG: ${{ github.event.inputs.DOCKER_IMAGE_TAG }}
            serverSelection: ${{ github.event.inputs.serverSelection }}
            environmentName: ${{ github.event.inputs.environmentName }}
            approvalEnvironmentName: ${{ env.approvalEnvironmentName }}
